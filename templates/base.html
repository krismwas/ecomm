{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <title>Hello, world!</title>
     {% include 'base/css.html' %}
     {% block base_head %}{% endblock base_head %}
  </head>
  <body>
    {% include 'navbar.html' with brandname='Ecommerce' %}
    <div class="container">
        {% block content %}

        {% endblock content %}
        {% include 'base/js.html' %}

        <script>
            $(document).ready(function () {
                var productForm = $(".form-product-ajax")

                productForm.submit(function (event) {
                    event.preventDefault();
                    var thisForm = $(this);
                    {#var actionEndpoint = thisForm.attr('action')#}
                    var actionEndpoint = thisForm.attr('data-endpoint')
                    var httpMethod = thisForm.attr('method')
                    var formData = thisForm.serialize();

                    $.ajax({
                        url: actionEndpoint,
                        method: httpMethod,
                        data: formData,
                        success: function (data) {
                            var submitSpan = thisForm.find(".submit-span")
                            if(data.added){
                                submitSpan.html(" <button type=\"submit\" class=\"btn btn-success\">Add to cart</button>")
                            } else {
                                submitSpan.html("In cart<button type=\"submit\" class=\"btn btn-link\">Remove</button>")
                            }
                            var navbarCartCount = $(".navbar-cart-count")
                            navbarCartCount.text(data.cartCount)

                            if(window.location.href.indexOf("home") == -1){
                                console.log(window.location.href.indexOf("home"))
                                console.log("nyama")
                                refreshCart()
                            }
                        },
                        error: function (errorData) {
                            console.log("error")
                            console.log(errorData)
                        }
                    })
                })

                function refreshCart() {
                    console.log("in current cart")
                    var cartTable = $(".cart-table")
                    var cartBody = cartTable.find(".cart-body")
                    cartBody.html("<h1>Changed</h1>")

                    var refreshCartUrl = '/api/cart/'
                    var refreshCartMethod = 'GET'
                    var data = {}
                    $.ajax({
                        url: refreshCartUrl,
                        method: refreshCartMethod,
                        data: data,
                        success: function () {
                            console.log("success")
                        },
                        error: function (errorData) {
                            console.log("error")
                            console.log(errorData)
                        } 
                    })
                }
            })
        </script>









    </div>
  </body>
</html>